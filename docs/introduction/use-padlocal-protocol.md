# ‰ΩøÁî®PadlocalÂçèËÆÆ

## ‰∏Ä„ÄÅ‰ªãÁªç

Êú¨ËäÇ‰∏é‰∏ä‰∏ÄÁØáÁ´†ÁöÑWebÂçèËÆÆÁõ∏ÊØîÔºåÂå∫Âà´Âè™ÊòØÂú®ÂêØÂä®ÊúçÂä°ÁöÑÁéØËäÇÔºöToken Gateway„ÄÇ

## ‰∫å„ÄÅ‰∏∫‰ªÄ‰πàÈúÄË¶ÅÁΩëÂÖ≥

### 2.1 TOKEN ÂçèËÆÆ

Âú®‰πãÂâçÁöÑ‰ªòË¥πÂæÆ‰ø°ÂçèËÆÆ‰∏≠ÔºåÈÄöÂ∏∏ÊòØÈúÄË¶ÅÂ∞ÜÊúçÂä°ÈÉ®ÁΩ≤Âú®ÂïÜÂÆ∂ÁöÑÈõÜÁæ§‰∏äÈù¢ÔºåÊâÄÊúâÁöÑÊ∂àÊÅØÊé•Âèó‰∏éÂèëÈÄÅÈÉΩÊòØÁªèËøáÂïÜÂÆ∂ÈõÜÁæ§Êù•ÁÆ°ÁêÜÔºåÈõÜ‰∏≠ÂºèÁÆ°ÁêÜÂõ∫ÁÑ∂ËÉΩÂ§üÁõëÊéßÊÑèÂ§ñbugÔºåÂèØÊòØ‰πüÂ∏¶Êù•‰∫Ü‰∏Ä‰∏™Âæà‰∏•ÈáçÁöÑÈóÆÈ¢òÔºöÊâÄÊúâÁöÑÊ∂àÊÅØÂèëÈÄÅÂíåÊé•ÂèóÁöÑIPÈÉΩÊòØÊù•Ëá™‰∫é‰∏Ä‰∏™IPÊ±†„ÄÇ

Ëøô‰∏™ÈóÆÈ¢ò‰ºöÂä†ÈáçË¥¶Âè∑ÁöÑÈ£éÈô©Á≥ªÊï∞ÔºåÊØïÁ´üÂÆòÊñπÊòØÂÖ∑Â§áÊúâ‰∏ÄÂÆöÁöÑË¥¶Âè∑È£éÊéßÊú∫Âà∂ÔºåËÆ©Áî®Êà∑ÁöÑË¥¶Âè∑Â§Ñ‰∫é‰∏Ä‰∏™Âç±Èô©ÁöÑÂ¢ÉÂú∞ÔºåÊãÖÂøÉÊ∂àÊÅØÊé•ÂèóÁöÑËøáÂ§öÔºåÂèëÈÄÅÁöÑËøáÂ§ö‰ºö‰∏ç‰ºöËÆ©Ëá™Â∑±Â∞ÅÂè∑Á≠âÁ≠âÔºåËÄå‰∏îËøô‰∫õÂõ†Á¥†ÁöÑËÄÉËôë‰πüÊòØÂêàÁêÜÁöÑ„ÄÇ

### 2.2 PadLocal

ÂΩìÁÑ∂‰πüÊúâ‰∏ÄÂÆöÁöÑËß£ÂÜ≥ÊñπÊ°àÔºöÂïÜÂÆ∂ÂèØ‰ª•Êç¢ÂØπÂ∫îÁöÑIPÊ±†ÔºåÈÄöËøá‰∏çÂÆöÊúüÁöÑË¥≠‰π∞Êñ∞ÁöÑIPÊù•ÂáèÂ∞ëÊ∂àÊÅØÊâéÂ†ÜÁöÑÈóÆÈ¢ò„ÄÇËøôÁßçÊñπÊ≥ïËôΩÁÑ∂ÊòØÁºìËß£‰∫ÜËøô‰∏™ÈóÆÈ¢òÔºåÂèØÊòØÁæäÊØõÂá∫Âú®ÁæäË∫´‰∏äÔºåÁª¥Êä§ÊàêÊú¨Â§ß‰∫ÜÔºå`TOKEN`ËÇØÂÆöÂ∞±Ë¥µ‰∫ÜÔºåÂØπ‰∫éÂèåÊñπÊù•ËØ¥ÈÉΩ‰∏çÂ§™Â•Ω„ÄÇ‰∫éÊòØÁ§æÂå∫Â∞±Âü∫‰∫éPadÂçèËÆÆÊèêÂá∫‰∫Ü`Local`ÁöÑÊ¶ÇÂøµÔºö[wechaty-puppet-padlocal](https://github.com/wechaty/wechaty-puppet-padlocal).

Ë¶Å‰ΩøÁî®Ê≠§ÂçèËÆÆÔºåÂøÖÈ°ªÂú®Êú¨Âú∞ÂºÄÂêØ‰∏Ä‰∏™GatewayÊù•ÂèëÈÄÅÂíåÊé•ÂèóÂÆòÊñπÊúçÂä°Âô®ÂèëÈÄÅËøáÊù•ÁöÑÊ∂àÊÅØÔºåËøôÊ†∑Ê∂àÊÅØÁöÑÊù•Ê∫êÂíåÂèëÈÄÅÁõÆÁöÑÂú∞ÈÉΩÊòØÁî±ÂºÄÂèëËÄÖËá™Â∑±ÂÜ≥ÂÆöÔºåÂ∞±Á±ª‰ºº‰∫éÁîµËÑëÁöÑÂÆ¢Êà∑Á´ØÊé•ÂèóÂíåÂèëÈÄÅÊ∂àÊÅØÔºåËøôÊ†∑Â∞±ÊûÅÂ§ßÁ®ãÂ∫¶‰∏äÂáèÂ∞è‰∫ÜË¥¶Âè∑È£éÈô©Á≥ªÊï∞ÔºåËøô‰πüÊòØÂçèËÆÆ‰∏≠`Local`ÁöÑÂéüÂõ†„ÄÇ

### 2.3 ‰ΩøÁî®Ê≠•È™§

Âç≥‰ΩøÊòØËøôÊ†∑Ôºå‰ΩøÁî®Ëµ∑Êù•‰∏éwebÂçèËÆÆÂå∫Âà´‰∏çÂ§ßÔºåÊï¥‰ΩìÊ≠•È™§‰πüÂàÜ‰∏∫‰∏§Ê≠•Ôºö

* ‰ΩøÁî®DockerÂêØÂä®PadlocalÁΩëÂÖ≥ÊúçÂä°
* ‰ΩøÁî®python-wechatyËøûÊé•ÊúçÂä°

## ‰∏â„ÄÅÂêØÂä®PadlocalÁΩëÂÖ≥ÊúçÂä°

### 3.1 ËÑöÊú¨

- [wechaty-puppet-padlocal](https://github.com/padlocal/wechaty-puppet-padlocal)
- [TOKEN Áî≥ËØ∑ÊñπÊ≥ï](https://wechaty.js.org/docs/puppet-services/)

```shell
# ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè

export WECHATY_LOG="verbose"
export WECHATY_PUPPET="wechaty-puppet-padlocal"
export WECHATY_PUPPET_PADLOCAL_TOKEN="puppet_padlocal_XXXXXX"

export WECHATY_PUPPET_SERVER_PORT="9001"
# ÂèØ‰ΩøÁî®‰ª£Á†ÅÈöèÊú∫ÁîüÊàêUUIDÔºöimport uuid;print(uuid.uuid4());
export WECHATY_TOKEN="1fe5f846-3cfb-401d-b20c-XXXXX"

docker run -ti \
  --name wechaty_puppet_service_token_gateway \
  --rm \
  -e WECHATY_LOG \
  -e WECHATY_PUPPET \
  -e WECHATY_PUPPET_PADLOCAL_TOKEN \
  -e WECHATY_PUPPET_SERVER_PORT \
  -e WECHATY_TOKEN \
  -p "$WECHATY_PUPPET_SERVER_PORT:$WECHATY_PUPPET_SERVER_PORT" \
  wechaty/wechaty:0.65
```

> Âú®Ê≠§ÊàëÈªòËÆ§ÊâÄÊúâÁöÑ‰∫∫ÈÉΩÂØπ[Docker](https://www.docker.com)ÁöÑÂü∫Êú¨‰ΩøÁî®Â∑≤ÁªèÊúâ‰∫Ü‰∏ÄÂÆöÁöÑ‰∫ÜËß£ÔºåÂê¶ÂàôÂèØ‰ª•Ëä±Âá†ÂàÜÈíüÂéªÁúãÁúãÂÖ∂[ÊñáÊ°£](https://www.docker.com/get-started)ÁÜüÊÇâ‰∏Ä‰∏ã„ÄÇ

### 3.2 ÂèÇÊï∞ËØ¥Êòé

* **WECHATY_PUPPET**: **Ê†áËØÜ**‰ΩøÁî®ÁöÑÂì™‰∏™ÂçèËÆÆÔºå‰∏ÄËà¨Âíå`token`Á±ªÂûãÁöÑ‰∏Ä‰∏ÄÂØπÂ∫î„ÄÇÊØîÂ¶ÇÂΩì‰ΩøÁî®`padlocal`ÂçèËÆÆÁöÑËØùÔºåÈÇ£Ëøô‰∏™Â∞±ÊòØ`wechaty-puppet-padlocal`ÔºåÂ¶ÇÊûú‰ΩøÁî®`web`ÂçèËÆÆÁöÑËØùÔºåÈÇ£Ëøô‰∏™Â∞±ÊòØ`wechaty-puppet-wechat`„ÄÇ
* **WECHATY_PUPPET_PADLOCAL_TOKEN**: Ëøô‰∏™ÂçèËÆÆÊòØÁî®Êù•ËøûÊé•PadlocalÁöÑÊúçÂä°ÔºåÁõÆÂâçÊòØ‰ªòË¥πÁöÑ„ÄÇ
* **WECHATY_PUPPET_SERVER_PORT**: ÁΩëÂÖ≥ÊúçÂä°ÁöÑÊé•Âè£ÔºåÊèê‰æõÁªô`python-wechaty`Êù•ËøûÊé•Ë∞ÉÁî®ÔºåÂ¶ÇÊûúÊúçÂä°ÈÉ®ÁΩ≤Âú®‰∫ëÊúçÂä°Âô®‰∏äÔºåÂàôÈúÄË¶Å‰øùËØÅËØ•Á´ØÂè£ÁöÑÂèØËÆøÈóÆÊÄß„ÄÇ
* **WECHATY_TOKEN**: ÂΩìÂºÄÂèëËÄÖÂú®Ëá™Â∑±Êú∫Âô®‰∏äÂêØÂä®‰∏Ä‰∏™ÁΩëÂÖ≥ÊúçÂä°Êó∂ÔºåÈúÄË¶ÅÈÄöËøá`TOEKN`Êù•ÂÅöË∫´‰ªΩÈ™åËØÅÔºåÈÅøÂÖçÊúçÂä°Ë¢´‰ªñ‰∫∫Á™ÉÂèñ„ÄÇ

‰ª•‰∏ä‰ª£Á†ÅÂè™ÈúÄË¶Å‰øÆÊîπ‰∏â‰∏™ÂèÇÊï∞Ôºö`WECHATY_PUPPET_PADLOCAL_TOKEN`, `WECHATY_PUPPET_SERVER_PORT`, `WECHATY_TOKEN` Âç≥ÂèØÊàêÂäüÂêØÂä®TokenÁΩëÂÖ≥ÊúçÂä°„ÄÇ

ÈÇ£ÁΩëÂÖ≥ÊúçÂä°ÂêØÂä®ÊàêÂäü‰πãÂêéÔºåÂè™ÈúÄË¶ÅÁºñÂÜô`python-wechaty`ÁöÑ‰ª£Á†ÅÊù•ËøûÊé•Âç≥ÂèØ„ÄÇ

## Âõõ„ÄÅËøûÊé•ÊúçÂä°

### 4.1 Êú¨Âú∞ÊµãËØïÂíåËøúÁ´ØÈÉ®ÁΩ≤

ÂΩìÂêØÂä®ÁΩëÂÖ≥ÊúçÂä°Êó∂Ôºå`Padlocal`‰ºöÊ†πÊçÆ`WECHATY_TOKEN`Êù•Âú®[WechatyÊúçÂä°Êé•Âè£](https://api.chatie.io/v0/hosties/__TOKEN__)‰∏äÊ≥®ÂÜåÈÉ®ÁΩ≤Êú∫Âô®ÁöÑ`IP`Âíå`Á´ØÂè£`ÔºåÁÑ∂Âêépython-wechaty‰ºöÊ†πÊçÆ`WECHATY_TOKEN`Âú®[WechatyÊúçÂä°Êé•Âè£](https://api.chatie.io/v0/hosties/__TOKEN__)‰∏äËé∑ÂèñÂØπÂ∫îÁöÑIPÂíåÁ´ØÂè£„ÄÇ

ÂèØÊòØÂæàÂ§öÂ∞è‰ºô‰º¥Âú®ÂÆûÈôÖÂºÄÂèëÁöÑËøáÁ®ã‰∏≠ÔºåÈÄöÂ∏∏‰ºöÂá∫Áé∞`endpoint is not invalid`Á≠âÈîôËØØ‰ø°ÊÅØÔºåÈÇ£ÊòØÂõ†‰∏∫ÂºÄÂèëËÄÖÊúâÂèØËÉΩÂú®Êú¨Âú∞ÂêØÂä®ÁΩëÂÖ≥ÊúçÂä°ÊàñËÄÖÊúçÂä°Âô®Á´ØÂè£Ê≤°ÊúâÂºÄÊîæ„ÄÇ

ÁΩëÂÖ≥ÊúçÂä°ÁöÑÈÉ®ÁΩ≤ÈÄöÂ∏∏ÊòØÂàÜ‰∏∫Êú¨Âú∞ÊµãËØïÂíåËøúÁ´ØÈÉ®ÁΩ≤ÔºåÂâçËÄÖÈÄöÂ∏∏Âè™ÊòØ‰∏∫‰∫ÜÂàùÂ≠¶ÊµãËØïÔºåÂêéËÄÖÊòØ‰∏∫‰∫ÜÁîü‰∫ßÈÉ®ÁΩ≤„ÄÇÂ¶ÇÊûúÊòØÂú®Áîü‰∫ßÈÉ®ÁΩ≤Êó∂ÔºåÂè™ÈúÄË¶ÅËÆæÁΩÆÁéØÂ¢ÉÂèòÈáè:

```shell
export WECHATY_PUPPET_SERVICE_TOKEN=1fe5f846-3cfb-401d-b20c-XXXXX
# or
export TOKEN=1fe5f846-3cfb-401d-b20c-XXXXX
# or
export token=1fe5f846-3cfb-401d-b20c-XXXXX
```

ÂèØÊòØÂ¶ÇÊûúÊòØÂú®Êú¨Âú∞ÊµãËØïÊó∂ÔºåÂàôÈÄöËøáENDPOINTÊù•ÊâæÂà∞ÂêØÂä®ÁöÑÁΩëÂÖ≥ÊúçÂä°„ÄÇ

```shell
export WECHATY_PUPPET_SERVICE_TOKEN=1fe5f846-3cfb-401d-b20c-XXXXX
# or
export TOKEN=1fe5f846-3cfb-401d-b20c-XXXXX
# or
export token=1fe5f846-3cfb-401d-b20c-XXXXX

export WECHATY_PUPPET_SERVICE_ENDPOINT=127.0.0.1:9001
# or
export ENDPOINT=127.0.0.1:9001
# or
export endpoint=127.0.0.1:9001
```

### 4.2 TOKENÁöÑ‰ΩúÁî®

ÊÄªËÄåË®Ä‰πã:

* Â¶ÇÊûúÊòØÂÖ¨ÁΩëÁéØÂ¢É‰∏ãÔºåÂèØÂè™ÈúÄË¶ÅËÆæÁΩÆ`TOKEN`Âç≥ÂèØÔºàÂõ†‰∏∫‰Ω†ÁöÑtokenÂ∑≤ÁªèÊ≥®ÂÜåÂú®chatie server‰∏äÔºåÊïÖÂèØ‰ª•Ëé∑ÂèñÂà∞ÁõÆÊ†áËµÑÊ∫êÊúçÂä°Âô®ÁöÑipÂíåportÔºâ
* Â¶ÇÊûúÊòØÂÜÖÁΩëÁéØÂ¢É‰∏ãÔºåÂèØÂè™ÈúÄË¶Å‰ΩøÁî®`ENDPOINT`(`localhost:port`)Êù•ËÆ©python-wechatyËøûÊé•ÁõÆÊ†áËµÑÊ∫êÊúçÂä°Âô®„ÄÇ

> Â¶ÇÊûúÊòØtokenÊòØpadlocalÁ±ªÂûãÔºåÂàôÂú®python-wechatyÁ®ãÂ∫èÂÜÖÈÉ®ÂèØÁõ¥Êé•ËÆæÁΩÆ`export endpoint=localhost:port`Êù•ËøûÊé•Gateway Server„ÄÇ

ÂΩìÁÑ∂Ôºå‰ª•‰∏äÁöÑÂÜôÊ≥ïÊòØ‰ΩøÁî®BashÁöÑÊñπÂºèÊù•ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÔºå‰πüÊòØÂèØ‰ª•ÈÄöËøápython‰ª£Á†ÅÊù•ËÆæÁΩÆÁéØÂ¢ÉÂèòÈáèÔºåËØ¶ÁªÜÂèØÁúãÔºö

```python
import os
os.environ['token'] = "1fe5f846-3cfb-401d-b20c-XXXXX"
os.environ['endpoint'] = "127.0.0.1:9001"
```

## ‰∫î„ÄÅÁ§∫‰æã‰ª£Á†Å

> talke is cheep, show you the code

```python
import asyncio, os
from typing import List, Optional, Union

from wechaty_puppet import FileBox  # type: ignore

from wechaty import Wechaty, Contact
from wechaty.user import Message, Room


class MyBot(Wechaty):

    async def on_message(self, msg: Message):
        """
        listen for message event
        """
        from_contact: Optional[Contact] = msg.talker()
        text = msg.text()
        room: Optional[Room] = msg.room()
        if text == 'ding':
            conversation: Union[
                Room, Contact] = from_contact if room is None else room
            await conversation.ready()
            await conversation.say('dong')
            file_box = FileBox.from_url(
                'https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/'
                'u=1116676390,2305043183&fm=26&gp=0.jpg',
                name='ding-dong.jpg')
            await conversation.say(file_box)

os.environ['TOKEN'] = "1fe5f846-3cfb-401d-b20c-XXXXX"
os.environ['WECHATY_PUPPET_SERVICE_ENDPOINT'] = "127.0.0.1:9001"
asyncio.run(MyBot().start())
```

Ê¨¢ËøéÂêÑ‰ΩçÂìÅÂ∞ù‰ª•‰∏ä‰ª£Á†Å ü•≥ 

* **Áõ∏ÂÖ≥ÈìæÊé•**
  * [python-wechaty](https://github.com/wechaty/python-wechaty)
  * [python-wechaty-getting-started](https://github.com/wechaty/python-wechaty-getting-started)
